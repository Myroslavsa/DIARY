Form1.h
using System;
using System.Collections.Generic;
using System.ComponentModel;
using System.Data;
using System.Drawing;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using System.Windows.Forms;
using System.IO;
using System.Xml.Serialization;

namespace kursova
{
    public partial class Form1 : Form
    {
        public class Podiya
        {
            public string naz;
            public string typ;
            public string data;
            public string chas;
            public string opys;
            public Podiya()
            {
                naz = "";
                typ = "";
                data = "";
                chas = "";
                opys = "";
            }
            public Podiya(string naz, string typ, string data, string chas, string opys)
            {
                this.naz = naz;
                this.typ = typ;
                this.data = data;
                this.chas = chas;
                this.opys = opys;
            }
        }

        class PodiyaList
        {
            XmlSerializer sr = new XmlSerializer(typeof(List<Podiya>));
            public List<Podiya> Shodennyk = new List<Podiya>();
            public void Add(string n, string t, string d, string c, string o, DataGridView dg)
            {
                Shodennyk.Add(new Podiya(n, t, d, c, o));
                dg.Rows.Add(Shodennyk[Shodennyk.Count - 1].naz, Shodennyk[Shodennyk.Count - 1].typ, Shodennyk[Shodennyk.Count - 1].data, Shodennyk[Shodennyk.Count - 1].chas);
            }
            public void Show(DataGridView dg)
            {
                dg.Rows.Clear();
                for (int i = 0; i < Shodennyk.Count; i++)
                    dg.Rows.Add(Shodennyk[i].naz, Shodennyk[i].typ, Shodennyk[i].data, Shodennyk[i].chas);
            }
            public void Reading()
            {
                FileStream file = new FileStream("data.txt", FileMode.Open, FileAccess.Read, FileShare.None);
                Shodennyk = (List<Podiya>)sr.Deserialize(file);
                file.Close();
            }
            public void Deleting(int i, DataGridView dg)
            {
                Shodennyk.RemoveAt(i);
                Show(dg);
            }
            public void Writing(string f)
            {
                FileStream file = new FileStream(f, FileMode.Create, FileAccess.Write, FileShare.None);
                sr.Serialize(file, Shodennyk);
                file.Close();
            }
            public void Searching(string s, DataGridView dg)
            {
                dg.Rows.Clear();
                for (int i = 0; i < Shodennyk.Count; i++)
                        if (Shodennyk[i].typ == s)
                            dg.Rows.Add(Shodennyk[i].naz, Shodennyk[i].typ, Shodennyk[i].data, Shodennyk[i].chas);
            }
        }

        PodiyaList A = new PodiyaList();

        public Form1()
        {
            InitializeComponent();
            A.Reading();
            A.Show(dataGridView1);
        }

        private void button1_Click(object sender, EventArgs e)
        {
            try
            {
                dataGridView2.Rows.Clear();
                for (int i = 0; i < A.Shodennyk.Count; i++)
                    if (A.Shodennyk[i].data == dateTimePicker1.Text)
                        dataGridView2.Rows.Add(A.Shodennyk[i].naz, A.Shodennyk[i].typ, A.Shodennyk[i].data, A.Shodennyk[i].chas);
                int temp = 0;
                double axn = int.Parse(textBox4.Text[0].ToString()) * 10 + int.Parse(textBox4.Text[1].ToString())+ int.Parse(textBox4.Text[3].ToString()) * 0.1 + int.Parse(textBox4.Text[4].ToString()) * 0.01;
                double axk = int.Parse(textBox4.Text[8].ToString()) * 10 + int.Parse(textBox4.Text[9].ToString()) + int.Parse(textBox4.Text[11].ToString()) * 0.1 + int.Parse(textBox4.Text[12].ToString()) * 0.01;
                for (int i = 0; i < dataGridView2.Rows.Count; i++)
                {
                    string t = dataGridView2.Rows[i].Cells[3].Value.ToString();
                    double xn = int.Parse(t[0].ToString()) * 10 + int.Parse(t[1].ToString()) + int.Parse(t[3].ToString()) * 0.1 + int.Parse(t[4].ToString()) * 0.01;
                    double xk = int.Parse(t[8].ToString()) * 10 + int.Parse(t[9].ToString()) + int.Parse(t[11].ToString()) * 0.1 + int.Parse(t[12].ToString()) * 0.01;
                    if (axn >= xn && axn < xk)
                    {
                        dataGridView2.Rows[i].DefaultCellStyle.BackColor = Color.IndianRed;
                        MessageBox.Show("Неможливо створити новий запис. Створюється накладання!");
                        temp = -1;
                        break;
                    }
                }
                if (temp != -1)
                {
                    for (int i = 0; i < dataGridView2.Rows.Count; i++)
                    {
                        string t = dataGridView2.Rows[i].Cells[3].Value.ToString();
                        double xn = int.Parse(t[0].ToString()) * 10 + int.Parse(t[1].ToString()) + int.Parse(t[3].ToString()) * 0.1 + int.Parse(t[4].ToString()) * 0.01;
                        double xk = int.Parse(t[8].ToString()) * 10 + int.Parse(t[9].ToString()) + int.Parse(t[11].ToString()) * 0.1 + int.Parse(t[12].ToString()) * 0.01;
                        if (axk > xn && axk <= xk)
                        {
                            dataGridView2.Rows[i].DefaultCellStyle.BackColor = Color.IndianRed;
                            MessageBox.Show("Неможливо створити новий запис. Створюється накладання!");
                            temp = -1;
                            break;
                        }
                    }
                }
                if (temp != -1)
                {
                    A.Add(textBox1.Text, comboBox3.Text, dateTimePicker1.Text, textBox4.Text, richTextBox1.Text, dataGridView1);
                }
                textBox1.Text = "";
                comboBox3.Text = "";
                dateTimePicker1.Text = "";
                textBox4.Text = "";
                richTextBox1.Text = "";
            }
            catch
            {
                MessageBox.Show("Некоректні дані");
            }
        }

        private void button2_Click(object sender, EventArgs e)
        {
            A.Writing("data.txt");
        }

        private void button7_Click(object sender, EventArgs e)
        {
            int temp = 0;
            for (int i = 0; i < A.Shodennyk.Count; i++)
                if (A.Shodennyk[i].naz == dataGridView1.Rows[dataGridView1.CurrentRow.Index].Cells[0].Value.ToString())
                {
                    temp = i;
                    break;
                }
            A.Deleting(temp, dataGridView1);
        }

        private void button3_Click(object sender, EventArgs e)
        {
            Form2 f = new Form2(dataGridView1.Rows[dataGridView1.CurrentRow.Index].Cells[0].Value.ToString());
            f.Show();
        }

        private void button5_Click(object sender, EventArgs e)
        {
            dataGridView2.Rows.Clear();
            for (int i = 0; i < A.Shodennyk.Count; i++)
                if (A.Shodennyk[i].data == dateTimePicker2.Text)
                    dataGridView2.Rows.Add(A.Shodennyk[i].naz, A.Shodennyk[i].typ, A.Shodennyk[i].data, A.Shodennyk[i].chas);
        }

        private void button4_Click(object sender, EventArgs e)
        {
            A.Searching(comboBox1.Text, dataGridView2);
        }
    }
}
